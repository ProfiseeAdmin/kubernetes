name: deploy-platform

on:
  workflow_dispatch:
    inputs:
      deployment:
        description: "Deployment folder name under customer-deployments"
        required: true
        default: "acme-prod"
      environment:
        description: "GitHub environment name for approvals"
        required: true
        default: "prod"

permissions:
  contents: read
  id-token: write

jobs:
  deploy:
    # For private EKS, use a self-hosted runner with network access to the VPC.
    runs-on: self-hosted
    environment: ${{ inputs.environment }}
    env:
      AWS_REGION: us-east-1
      DEPLOYMENT: ${{ inputs.deployment }}
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Configure AWS credentials (OIDC)
        uses: aws-actions/configure-aws-credentials@v4
        with:
          role-to-assume: ${{ secrets.AWS_ROLE_ARN }}
          role-session-name: deploy-platform-${{ github.run_id }}
          aws-region: ${{ env.AWS_REGION }}

      - name: Deploy platform (placeholder)
        shell: pwsh
        run: |
          .\scripts\kubeconfig.ps1 $env:DEPLOYMENT
          .\scripts\deploy-platform.ps1 $env:DEPLOYMENT

